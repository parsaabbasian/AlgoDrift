<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Search</title>
    <link rel="icon" type="image/svg+xml" href="../logo.svg">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Default (Dark Mode) Styles */
        .target-display {
            background: rgba(255, 255, 255, 0.05); /* Subtle dark background */
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #ffffff; /* White text for dark mode */
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        /* Light Mode Overrides */
        body.light-mode .target-display {
            background: #f0f0f0;
            color: #333333;
            border: 1px solid #ccc;
        }

        .found { background-color: #4caf50 !important; }
        .visited { opacity: 0.5; }
    </style>
</head>
<body>

    <a href="../index.html" class="nav-link"><span>&#8592;</span> Back</a>

    <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </button>

    <header>
        <h1>Linear Search</h1>
        <div class="complexity-stats">
            <span>Time: O(n)</span>
            <span>Space: O(1)</span>
        </div>
    </header>

    <div class="controls">
        <button onclick="resetArray()" id="resetBtn">New Search</button>
        <button onclick="startSearch()" id="startBtn">Find Target</button>
        <button onclick="pauseSearch()" id="pauseBtn" disabled>Pause</button>
        <button onclick="continueSearch()" id="continueBtn" disabled>Resume</button>
        
        <div class="speed-control">
            <span>Fast</span>
            <input type="range" id="speedSlider" min="50" max="800" value="300">
            <span>Slow</span>
        </div>
    </div>

    <div class="main-content">
        <div class="chart-wrapper">
            <div id="target-display" class="target-display">Target: ?</div>
            <div class="chart-container" id="chart-container"></div>
        </div>

        <div class="code-window">
            <div class="window-header">
                <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                <span id="status-text">SYSTEM READY</span>
            </div>
            <pre><span id="line-1" class="code-line"><span class="kw">function</span> <span class="func">linearSearch</span>(arr, target) {</span>
<span id="line-2" class="code-line">  <span class="kw">for</span> (<span class="kw">let</span> i = 0; i < arr.length; i++) {</span>
<span id="line-3" class="code-line">    <span class="comment">// Check if current element is target</span></span>
<span id="line-4" class="code-line">    <span class="kw">if</span> (arr[i] === target) {</span>
<span id="line-5" class="code-line">      <span class="kw">return</span> i; <span class="comment">// Found</span></span>
<span id="line-6" class="code-line">    }</span>
<span id="line-7" class="code-line">  }</span>
<span id="line-8" class="code-line">  <span class="kw">return</span> -1; <span class="comment">// Not found</span></span>
<span id="line-9" class="code-line">}</span></pre>
        </div>
    </div>

    <details class="info-box">
        <summary>How it Works</summary>
        <div class="info-content">
            <p><strong>Concept:</strong> Linear Search is the simplest searching algorithm. It checks every element in the list sequentially until the desired element is found or the list ends.</p>
            <p><strong>Steps:</strong></p>
            <ul>
                <li><strong>Start:</strong> Begin at the first element (index 0).</li>
                <li><strong>Compare:</strong> Compare the current element with the target value.</li>
                <li><strong>Match:</strong> If they match, return the index.</li>
                <li><strong>Next:</strong> If not, move to the next element.</li>
                <li><strong>End:</strong> Repeat until the target is found or the end of the list is reached.</li>
            </ul>
        </div>
    </details>

    <script>
        const container = document.getElementById('chart-container');
        const targetDisplay = document.getElementById('target-display');
        const statusText = document.getElementById('status-text');
        const speedSlider = document.getElementById('speedSlider');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const continueBtn = document.getElementById('continueBtn');
        const themeBtn = document.getElementById('themeBtn');

        const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
        const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            if (document.body.classList.contains('light-mode')) {
                themeBtn.innerHTML = moonIcon;
            } else {
                themeBtn.innerHTML = sunIcon;
            }
        }

        let array = [];
        let target = 0;
        const ARRAY_SIZE = 15;
        let isPaused = false;
        let stopRequested = false;
        let pauseResolver = null;
        let audioCtx = null;

        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
        function playNote(freq, type = 'sine') {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
        
        async function checkPause() {
            if (isPaused) {
                const prevText = statusText.innerText;
                statusText.innerText = "PAUSED";
                await new Promise(resolve => { pauseResolver = resolve; });
                statusText.innerText = prevText;
            }
        }

        function highlightLine(lineNumber) {
            document.querySelectorAll('.code-line').forEach(el => el.classList.remove('active-line'));
            const line = document.getElementById(`line-${lineNumber}`);
            if (line) line.classList.add('active-line');
        }

        function resetArray() {
            stopRequested = true; 
            isPaused = false;
            if (pauseResolver) pauseResolver();

            // Reset Button States
            startBtn.disabled = true;
            resetBtn.disabled = true;
            pauseBtn.disabled = true;
            continueBtn.disabled = true;
            
            setTimeout(() => {
                stopRequested = false;
                container.innerHTML = '';
                array = [];
                for (let i = 0; i < ARRAY_SIZE; i++) {
                    const val = Math.floor(Math.random() * 90) + 10;
                    array.push(val);
                    const bar = document.createElement('div');
                    bar.classList.add('bar');
                    bar.style.height = `${val}%`;
                    bar.id = `bar-${i}`;
                    bar.innerText = val;
                    bar.style.display = 'flex';
                    bar.style.alignItems = 'flex-end';
                    bar.style.justifyContent = 'center';
                    bar.style.color = 'white';
                    bar.style.fontSize = '12px';
                    bar.style.paddingBottom = '5px';
                    container.appendChild(bar);
                }
                
                target = array[Math.floor(Math.random() * array.length)];
                targetDisplay.innerText = `Target: ${target}`;
                
                statusText.innerText = "READY";
                highlightLine(0);
                
                // Enable Start, Disable others
                startBtn.disabled = false;
                resetBtn.disabled = false;
            }, 100);
        }

        function startSearch() { initAudio(); linearSearch(); }
        
        function pauseSearch() { 
            if(!isPaused) {
                isPaused = true; 
                pauseBtn.disabled = true;
                continueBtn.disabled = false;
                resetBtn.disabled = false; // ENABLED: User can reset while paused
            }
        }
        
        function continueSearch() { 
            if(isPaused) {
                isPaused = false; 
                if(pauseResolver) pauseResolver(); 
                pauseBtn.disabled = false;
                continueBtn.disabled = true;
                resetBtn.disabled = true; // DISABLED: Locked again while running
            }
        }

        async function linearSearch() {
            statusText.innerText = "SEARCHING...";
            startBtn.disabled = true;
            resetBtn.disabled = true;
            pauseBtn.disabled = false;
            continueBtn.disabled = true;

            highlightLine(1);
            
            for (let i = 0; i < array.length; i++) {
                if (stopRequested) break;
                await checkPause(); // Check at start of loop

                highlightLine(2);
                const bar = document.getElementById(`bar-${i}`);
                bar.classList.add('compare');
                playNote(200 + (i * 20));

                let delay = parseInt(speedSlider.value);
                await sleep(delay);
                
                if (stopRequested) break;
                await checkPause(); // Check immediately after wait (fixes lag)

                highlightLine(4);
                if (array[i] === target) {
                    highlightLine(5);
                    bar.classList.remove('compare');
                    bar.classList.add('found');
                    bar.style.backgroundColor = '#4caf50';
                    playNote(600, 'square');
                    statusText.innerText = `FOUND AT INDEX ${i}`;
                    break;
                } else {
                    bar.classList.remove('compare');
                    bar.style.opacity = '0.4';
                }
            }
            
            resetBtn.disabled = false;
            pauseBtn.disabled = true;
            continueBtn.disabled = true;
        }

        window.onload = resetArray;
    </script>
</body>
</html>